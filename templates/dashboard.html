{% extends 'base.html' %}
{% block title %}Dashboard · Paper Trader{% endblock %}
{% block content %}

 

  <div
    hx-get="{{ url_for('price_alerts') }}"
    hx-trigger="load, every 5s"
    hx-swap="none">
  </div>

  <div hx-get="{{ url_for('dash_tick') }}"
     hx-trigger="load, every 5s"
     hx-swap="none">
  </div>

  <style>
  body {
    font-family: system-ui, sans-serif;
    margin: 0;
    background: linear-gradient(90deg, #f0f4ff, #306e8b);
    color: #333;
  }

  h2 {
    margin-bottom: 1rem;
    color: #222;
    font-weight: 600;
  }

  /* Card styling */
  .card {
    background: linear-gradient(180deg, #f0f4ff, #d7f2ff);
    border: 1px solid #000000;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  /* Grid layout for Prices + Order Form */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  /* Inputs */
  input, select {
    width: 100%;
    padding: .75rem;
    margin-top: .4rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  input:focus, select:focus {
    border-color: #0077ff;
    outline: none;
    box-shadow: 0 0 0 3px rgba(0,119,255,0.1);
  }

  .search-input,
.symbol-input {
  width: 100%;
  max-width: 320px;   /* keeps them from being too long */
  margin: 0 auto 1rem auto; /* centers inside card and adds spacing */
  display: block;
}

/* Make buttons align with inputs */
.search-btn,
.symbol-btn {
  display: block;
  margin: 0.5rem auto;
  max-width: 320px;
  width: 100%;
}


  /* Buttons */
  button {
    padding: .75rem 0.5rem;
    background: #238aff;
    color: #fff;
    border: 1px solid black;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #005fcc;
  }

  /* Reset button variant */
  .btn-reset {
    background: #dc2522;
  }
  .btn-reset:hover {
    background: #c62828;
  }

  /* Reset section */
  .reset-section {
    background: #fdf2f2;
    border: 1px solid #f5c2c2;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
  }
  .reset-desc {
    margin-bottom: 1rem;
    color: #bd5f5f;
  }

  /* Search results spacing */
  #search-results {
    margin-top: 1rem;
  }

  /* Watchlist header spacing */
  #watchlist-header {
    margin-bottom: 1rem;
  }
</style>

  <!-- Search Stocks Card -->
  <div class="card">
    <h2>Search Stocks</h2>
    <form hx-get="{{ url_for('search_stocks') }}" 
          hx-target="#search-results" 
          hx-trigger="keyup delay:300ms from:#search-input"
          hx-swap="innerHTML">
      <input 
        id="search-input"
        type="text" 
        name="q" 
        placeholder="Search by symbol or company name (e.g., AAPL or Apple)"
        autocomplete="off"
        style="width: 97%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
    </form>
    <div id="search-results" style="margin-top: 1rem;"></div>
  </div>


  <!-- Prices + Order Form grid -->
  <div class="grid">
    <div class="card">
      <h2>Prices</h2>
      <!-- no polling here now -->
      <div id="prices">Loading prices...</div>
    </div>

    <div class="card">
      <h2>Place Order</h2>
      <div id="order-form">
        <form hx-post="{{ url_for('place_order') }}" hx-target="#order-form" hx-swap="innerHTML">
          <label>Symbol</label><br>
          <select name="symbol">
            {% for t in tickers %}
              <option value="{{ t.symbol }}">{{ t.symbol }}</option>
            {% endfor %}
          </select><br><br>

          <label>Side</label><br>
          <select name="side">
            <option value="BUY">Buy</option>
            <option value="SELL">Sell</option>
          </select><br><br>

          <label>Type</label><br>
          <select name="order_type">
            <option value="MKT">Market</option>
            <option value="LMT">Limit</option>
          </select><br><br>

          <label>Qty</label><br>
          <input type="number" name="qty" min="1" value="1" /><br><br>

          <label>Limit Price (for LMT)</label><br>
          <input type="text" name="limit_price" placeholder="e.g. 123.45" /><br><br>

          <button type="submit">Submit</button>
        </form>
      </div>
    </div>
  </div>

    <!-- Watchlist -->
  <form hx-post="{{ url_for('add_watchlist_item') }}"
      hx-target="#watchlist"
      hx-swap="innerHTML">
  <input type="text" name="symbol" placeholder="Enter Symbol" style="width:97%; border:1px solid black;" required>
  <button type="submit">Add to Watchlist</button>
  </form>

  <div class="card">
  <div id="watchlist-header">
    {% include "_watchlist_header.html" %}
  </div>

  <div id="watchlist">Loading watchlist...</div>
</div>


  <!-- Positions -->
  <div class="card">
    <h2>Your Positions</h2>
    <div id="positions" hx-get="{{ url_for('positions_partial') }}" hx-trigger="load, every 6s" hx-swap="innerHTML">
      Loading positions...
    </div>
    <hr style="margin: 1rem 0; border: none; border-top: 1px solid #ddd;">

    <div class="reset-section">
      <p class="reset-desc">
        To Reset your portfolio, simply press the <strong>Reset Portfolio</strong> button to 
        set clear your positions and set your balance to <strong>$100,000.00</strong>.
      </p>
      <form action="{{ url_for('reset_portfolio') }}" method="post"
            onsubmit="return confirm('Are you sure you want to reset your portfolio? This will remove all positions and set your balance to 0.');">
        <button type="submit" class="btn-reset">Reset Portfolio</button>
      </form>
    </div>
  </div>

<div class="card">
  <h2>Historical Performance</h2>

  <div
    id="performance-chart-wrapper"
    hx-get="{{ url_for('performance_chart_png') }}"
    hx-trigger="load"
    hx-target="#performance-chart-wrapper"
    hx-swap="innerHTML"
  >
    <p>Loading performance chart…</p>
  </div>
</div>


{% endblock %}
