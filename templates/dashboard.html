{% extends 'base.html' %}
{% block title %}Dashboard Â· Paper Trader{% endblock %}
{% block content %}

  <div
    hx-get="{{ url_for('price_alerts') }}"
    hx-trigger="load, every 5s"
    hx-swap="none">
  </div>

  <div hx-get="{{ url_for('dash_tick') }}"
     hx-trigger="load, every 5s"
     hx-swap="none">
  </div>

  <!-- Search Stocks Card -->
  <div class="card">
    <h2>Search Stocks</h2>
    <form hx-get="{{ url_for('search_stocks') }}" 
          hx-target="#search-results" 
          hx-trigger="keyup delay:300ms from:#search-input"
          hx-swap="innerHTML">
      <input 
        id="search-input"
        type="text" 
        name="q" 
        placeholder="Search by symbol or company name (e.g., AAPL or Apple)"
        autocomplete="off"
        style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
    </form>
    <div id="search-results" style="margin-top: 1rem;"></div>
  </div>


  <!-- Prices + Order Form grid -->
  <div class="grid">
    <div class="card">
      <h2>Prices</h2>
      <!-- no polling here now -->
      <div id="prices">Loading prices...</div>
    </div>

    <div class="card">
      <h2>Place Order</h2>
      <div id="order-form">
        <form hx-post="{{ url_for('place_order') }}" hx-target="#order-form" hx-swap="innerHTML">
          <label>Symbol</label><br>
          <select name="symbol">
            {% for t in tickers %}
              <option value="{{ t.symbol }}">{{ t.symbol }}</option>
            {% endfor %}
          </select><br><br>

          <label>Side</label><br>
          <select name="side">
            <option value="BUY">Buy</option>
            <option value="SELL">Sell</option>
          </select><br><br>

          <label>Type</label><br>
          <select name="order_type">
            <option value="MKT">Market</option>
            <option value="LMT">Limit</option>
          </select><br><br>

          <label>Qty</label><br>
          <input type="number" name="qty" min="1" value="1" /><br><br>

          <label>Limit Price (for LMT)</label><br>
          <input type="text" name="limit_price" placeholder="e.g. 123.45" /><br><br>

          <button type="submit">Submit</button>
        </form>
      </div>
    </div>
  </div>

    <!-- Watchlist -->
  <form hx-post="{{ url_for('add_watchlist_item') }}"
      hx-target="#watchlist"
      hx-swap="innerHTML">
  <input type="text" name="symbol" placeholder="Enter Symbol" required>
  <button type="submit">Add to Watchlist</button>
  </form>

  <div class="card">
    <h2>Your Watchlist</h2>
    <div id="watchlist">Loading watchlist...</div>
  </div>

  <!-- Positions -->
  <div class="card">
    <h2>Your Positions</h2>
    <div id="positions" hx-get="{{ url_for('positions_partial') }}" hx-trigger="load, every 6s" hx-swap="innerHTML">
      Loading positions...
    </div>
    <hr style="margin: 1rem 0; border: none; border-top: 1px solid #ddd;">

    <div class="reset-section">
      <p class="reset-desc">
        To Reset your portfolio, simply press the <strong>Reset Portfolio</strong> button to 
        set clear your positions and set your balance to <strong>$100,000.00</strong>.
      </p>
      <form action="{{ url_for('reset_portfolio') }}" method="post"
            onsubmit="return confirm('Are you sure you want to reset your portfolio? This will remove all positions and set your balance to 0.');">
        <button type="submit" class="btn-reset">Reset Portfolio</button>
      </form>
    </div>
  </div>
{% endblock %}
